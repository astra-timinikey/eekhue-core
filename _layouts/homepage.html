<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ page.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Roboto+Slab&display=swap" rel="stylesheet">
  <!-- Base styles (global) -->
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/base.css">
  <!-- Header & Footer styles only -->
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/header.css">
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/footer.css">
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/home.css">
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/xp.css">
  <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/starfield.css">

  <script>
    const BASEURL = "{{ site.baseurl }}"; // e.g. "/eekhue-core"
  </script>
  <!-- Header JS only -->
  <script src="{{ site.baseurl }}/assets/js/header.js" defer></script>
  <script src="{{ site.baseurl }}/assets/js/home.js" defer></script>
  <script src="{{ site.baseurl }}/assets/js/xp.js" defer></script>
  <script src="{{ site.baseurl }}/assets/js/starfield.js" defer></script>
</head>

<body>

  {% include header.html %}

  <section class="hero">
    <h1>{{ page.hero_title }}</h1>
    <p class="lead">{{ page.hero_subtitle }}</p>
    <div class="pill">âœ¨ Powered by GitHub Pages</div>
  </section>
  
  <div id="debug"></div>

  <main>
    <!-- STARFIELD CONTENT DIRECTLY IN LAYOUT -->
    <div class="starfield-realm-map">
      <canvas id="starfield-new"></canvas>
      
      <div class="starfield-planets-container">
        {% for planet in site.data.planets %}
          <div class="starfield-planet" 
               id="starfield-{{ planet.id }}" 
               data-title="{{ planet.emoji }} {{ planet.name }}"
               data-text="{{ planet.popup.description }}"
               data-config="{{ planet | jsonify | escape }}"
               style="left: {{ planet.position.x }}%; 
                      top: {{ planet.position.y }}%; 
                      --base-size: {{ planet.size }}px;
                      --hover-scale: {{ planet.hover_scale | default: 1.2 }};
                      --float-speed: {{ planet.animation.float_speed | default: 3 }}s;
                      --float-amplitude: {{ planet.animation.float_amplitude | default: 8 }}px;">
            
            {% for layer in planet.layers %}
              <div class="starfield-planet-layer"
                   data-layer-index="{{ forloop.index0 }}"
                   style="--layer-size: calc(var(--base-size) * {{ layer.size_multiplier | default: 1.0 }});
                          --layer-opacity: {{ layer.opacity | default: 1.0 }};
                          --layer-z: {{ layer.z_index | default: forloop.index }};
                          {% if layer.position_offset %}
                            --offset-x: {{ layer.position_offset.x | default: 0 }}px;
                            --offset-y: {{ layer.position_offset.y | default: 0 }}px;
                          {% endif %}
                          {% if layer.rotation %}
                            --rotation: {{ layer.rotation }}deg;
                          {% endif %}
                          {% if layer.mask %}
                            --mask: {{ layer.mask }};
                          {% endif %}
                          --blend-mode: {{ layer.blend_mode | default: 'normal' }};">
                
                <img src="{{ site.baseurl }}/assets/images/{{ layer.image }}" 
                     alt="{{ planet.name }} layer {{ forloop.index }}" 
                     class="starfield-layer-image">
              </div>
            {% endfor %}
            
            <!-- Planet emoji label -->
            <div class="starfield-planet-label">{{ planet.emoji }}</div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- NEW POPUP (separate from your existing one) -->
    <div id="starfield-popup" class="starfield-popup-overlay">
      <span id="starfield-close">&times;</span>
      <h3 id="starfield-title"></h3>
      <p id="starfield-text"></p>
    </div>
    
    {{ content }}
  </main>

  {% include footer.html %}

  {% include xp.html %}
  
</body>
</html>
  
</body>
</html>
